<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search & Filter Warehouse Layout</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        .shelf { stroke: #000; stroke-width: 1px; fill: white; }
        .highlight { fill: yellow; }
        .text { font-size: 12px; text-anchor: middle; }
        .button { margin-top: 20px; padding: 10px 20px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        .button:hover { background-color: #45a049; }
    </style>
</head>
<body>
    <h1>Search & Filter Warehouse Layout</h1>
    <input type="text" id="searchInput" placeholder="Enter product name">
    <button onclick="searchProduct()" class="button">Search</button>
    <div id="warehouse2D"></div>
    <div id="message"></div>

    <script>
        const warehouseData = JSON.parse('{{ warehouse_data | tojson | safe }}');

        const width = 1000;
        const height = 800;
        const shelfWidth = 120;
        const shelfHeight = 80;

        const svg = d3.select("#warehouse2D")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .attr("xmlns", "http://www.w3.org/2000/svg");

        // Add a white background to the SVG
        svg.append("rect")
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("fill", "white");

        warehouseData.forEach((item, index) => {
            const x = (index % 8) * shelfWidth;
            const y = Math.floor(index / 8) * shelfHeight;

            svg.append("rect")
                .attr("x", x)
                .attr("y", y)
                .attr("width", shelfWidth)
                .attr("height", shelfHeight)
                .attr("class", "shelf")
                .attr("id", `shelf-${index}`);

            svg.append("text")
                .attr("x", x + shelfWidth / 2)
                .attr("y", y + shelfHeight / 2 - 20)
                .attr("class", "text")
                .text(`${item["Shelf Number"]}`);

            svg.append("text")
                .attr("x", x + shelfWidth / 2)
                .attr("y", y + shelfHeight / 2)
                .attr("class", "text")
                .text(`${item["Product Name"]}`);

            svg.append("text")
                .attr("x", x + shelfWidth / 2)
                .attr("y", y + shelfHeight / 2 + 20)
                .attr("class", "text")
                .text(`${item["Quantity Available"]}`);
        });

        function searchProduct() {
            const searchInput = document.getElementById("searchInput").value.toLowerCase();
            let found = false;

            // Reset all highlights
            d3.selectAll(".shelf").classed("highlight", false);

            warehouseData.forEach((item, index) => {
                const shelf = d3.select(`#shelf-${index}`);
                if (item["Product Name"].toLowerCase().includes(searchInput)) {
                    shelf.classed("highlight", true);
                    found = true;
                }
            });

            const message = document.getElementById("message");
            if (found) {
                message.textContent = "";
            } else {
                message.textContent = "Product not found in warehouse.";
            }
        }
    </script>
</body>
</html>